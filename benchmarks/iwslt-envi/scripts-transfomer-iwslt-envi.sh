# IWSLT en-vi 2015

# *** small network

# small network w/o dropout
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do000000000000_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.0 --decoder-sublayer-dropout-p 0.0 --attention-dropout-p 0.0 --ff-dropout-p 0.0 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do000000000000_att1_ls00_pe1_ml150_ffrelu &
# decode
./build_gpu/transformer-decode --dynet-devices GPU:3 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do000000000000_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do000000000000_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do000000000000_att1_ls00_pe1_ml150_ffrelu.score-BLEU &

# small network w/ dropout
nice ./build_gpu/transformer-train --dynet-devices GPU:2 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu &
nice ./build_gpu/transformer-train --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -i experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.00078125 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log1.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu & #continue
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:3 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu.score-BLEU

# small network w/ dropout + w/ label smoothing
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu &
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -i experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu -e 100 --lr-eta 0.00625 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log1.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu.score-BLEU

# small network w/ dropout + w/ label smoothing (without key and query maskings)
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_nokqm -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_nokqm &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-nokqm.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_nokqm
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_nokqm &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_nokqm.score-BLEU

# small network w/ dropout + w/ label smoothing (use sinusoid encoding)
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 150 --minibatch-size 1024 --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu.score-BLEU

# small network w/ dropout + w/ label smoothing (use sinusoid encoding) (run2)
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --minibatch-size 1024 --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-sinusoid-run2.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2.score-BLEU

# small network w/ dropout + w/ label smoothing (use RNN input and outpout embedings)
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --minibatch-size 1024 --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_ml150_ffrelu_hybrid -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --use-hybrid-model &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_ml150_ffrelu_hybrid &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:1 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-hybrid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_ml150_ffrelu_hybrid
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_ml150_ffrelu_hybrid &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_ml150_ffrelu_hybrid.score-BLEU

# small network w/ dropout + w/ label smoothing (use sinusoid encoding) + w/ input feeding
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --minibatch-size 1024 --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_if -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_if &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_if
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_if &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_if.score-BLEU

# small network w/ dropout + w/ label smoothing + 1-gram input
nice ./build_gpu/transformer-train --dynet-devices GPU:5 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_1gram -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_1gram &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-1gram.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_1gram
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_1gram &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_1gram.score-BLEU

# small network w/ dropout + w/ label smoothing (use Adam trainer)
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_adam -e 100 --lr-eta 0.001 --sgd-trainer 4 --lr-patience 10 --patience 20 --lr-eta-decay 1.5 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_adam &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:5 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-adam.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_adam
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_adam &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe1_ml150_ffrelu_adam.score-BLEU

# small network w/ dropout + w/ label smoothing (use Adam trainer and sinusoid positional encoding)
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam -e 100 --lr-eta 0.001 --sgd-trainer 4 --lr-patience 10 --patience 20 --lr-eta-decay 1.5 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:1 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-dropout-labelsm-adam-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam.score-BLEU

# small network 2 w/ dropout + w/ label smoothing (use sinusoid encoding)
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 150 --minibatch-size 1024 --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 512 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small2-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h2_l2_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu.score-BLEU

#-------------------------
# small network for debugging
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/debug.params -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.0 --decoder-sublayer-dropout-p 0.0 --attention-dropout-p 0.0 --ff-dropout-p 0.0 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log.debug &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-debug.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug.score-BLEU

nice ./build_gpu/transformer-train --dynet-profiling 1 --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/debug1.params -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log.debug1 &
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -i experiments/models/iwslt-envi/debug1.params -p experiments/models/iwslt-envi/debug1.params.inc -e 100 --lr-eta 0.003125 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log1.debug1 &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-debug1.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug1
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug1 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug1.score-BLEU
# ensemble decoding
./build_gpu/transformer-decode --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-debug1-ensemble.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug1.ensemble
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug1.ensemble &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug1.ensemble.score-BLEU

# w/ label smoothing
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/debug2.labelsm.params -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.1 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing &>experiments/models/iwslt-envi/log.debug2.labelsm &
# decode beam 5
./build_gpu/transformer-decode --dynet-devices GPU:0 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-small-debug2-labelsm.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug2.labelsm
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug2.labelsm &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.debug2.labelsm.score-BLEU

#-------------------------

# small network w/ dropout, w/ adam
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu_adam -e 100 --lr-eta 0.001 --sgd-trainer 4 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h2_l2_u128_do010101010001_att1_ls00_pe1_ml150_ffrelu_adam &

# *** medium network w/ dropout
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l2_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1  --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 512 --num-heads 8 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l2_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &
# decode
./build_gpu/transformer-decode --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-medium-dropout.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l2_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l2_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l2_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu.score-BLEU &

# *** medium network w/ dropout + w/ label smoothing + w/ sinusoid
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1  --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -i experiments/models/iwslt-envi/params.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu -p experiments/models/iwslt-envi/params.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu -e 100 --lr-eta 0.05 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1  --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log1.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu & #continued
# decode
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-medium-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu.score-BLEU &
# ensemble decoding with small and medium models
# dev
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-dropout-labelsm-sinusoid-ensemble_small_medium.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.ensemble_small_medium
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.ensemble_small_medium &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.ensemble_small_medium.score-BLEU &
# test
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-dropout-labelsm-sinusoid-ensemble_small_medium.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.ensemble_small_medium
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.ensemble_small_medium &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.ensemble_small_medium.score-BLEU &

# ensemble decoding with 2 small and 2 medium models
# dev
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-dropout-labelsm-sinusoid-ensemble_2small_2medium.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.ensemble_2small_2medium
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.ensemble_2small_2medium &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.ensemble_2small_2medium.score-BLEU &
# test
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-dropout-labelsm-sinusoid-ensemble_2small_2medium.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.ensemble_2small_2medium
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.ensemble_2small_2medium &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.ensemble_2small_2medium.score-BLEU &

# *** medium network w/ dropout + w/ label smoothing + w/ sinusoid (run2)
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1  --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 &
# decode
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-medium-dropout-labelsm-sinusoid-run2.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2.score-BLEU &

# *** medium network w/ dropout + w/ label smoothing + w/ sinusoid (run3)
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1  --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3 &
# decode
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-medium-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3.score-BLEU &

# *** large networks
# train
# w/o dropout
nice ./build_gpu/transformer-train --dynet-devices GPU:5 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do000000000000_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.0 --decoder-sublayer-dropout-p 0.0 --attention-dropout-p 0.0 --ff-dropout-p 0.0 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do000000000000_att1_ls00_pe1_ml150_ffrelu &
# decode
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:2 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do000000000000_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do000000000000_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do000000000000_att1_ls00_pe1_ml150_ffrelu.score-BLEU

# w/ dropout
nice ./build_gpu/transformer-train --dynet-devices GPU:5 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &
# decode
# tst2012
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:0 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu.score-BLEU
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu.score-BLEU
# w/ length normalisation
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5-lennorm.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5-lennorm.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5-lennorm.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu.score-BLEU
# beam10
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 10 --model-cfg experiments/models/iwslt-envi/model-large-dropout.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam10.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam10.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam10.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu.score-BLEU

# w/ dropout + w/ label smoothing
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu &
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -i experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_inc -e 100 --lr-eta 0.00001 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --sgd-trainer 4 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_inc & #incremental
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu.score-BLEU

nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2 & # run 2
# tst2012 (dev)
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-run2.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2 &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2.score-BLEU
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-run2.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run2.score-BLEU

nice ./build_gpu/transformer-train --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run3 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run3 & # run 3
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:0 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-run3.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run3
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run3 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_run3.score-BLEU

# ensemble decoding with 3 different runs
# tst2012 (dev)
# beam5
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:5 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-ensemble3runs.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_ensemble3runs
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_ensemble3runs &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_ensemble3runs.score-BLEU
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:5 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-ensemble3runs.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_ensemble3runs
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_ensemble3runs &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe1_ml150_ffrelu_ensemble3runs.score-BLEU

# w/ attention dropout (incremental training)
nice ./build_gpu/transformer-train --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -i experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls00_pe1_ml150_ffrelu -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010101_att1_ls00_pe1_ml150_ffrelu_inc -e 100 --lr-eta 0.0125 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.1 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010101_att1_ls00_pe1_ml150_ffrelu &
# decode
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:3 --max-seq-len 150 --max-pos-seq-len 150 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout_inc_att.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010101_att1_ls00_pe1_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010101_att1_ls00_pe1_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010101_att1_ls00_pe1_ml150_ffrelu.score-BLEU

# large networks w/ dropout + w/ label smoothing (w/ sinusoid encoding)
nice ./build_gpu/transformer-train --max-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu -e 100 --lr-eta 1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &
# tst2012 (dev)
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:2 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu.score-BLEU
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:2 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu.score-BLEU

nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 & # run 2
# tst2012 (dev)
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:2 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid-run2.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2.score-BLEU
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:6 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid-run2.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run2.score-BLEU

nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024  --treport 500 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3 & # run 3
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:0 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid-run3.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3 &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_run3.score-BLEU

# ensemble decoding with 3 different runs
# tst2012 (dev)
# beam5
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:2 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid-ensemble3runs.cfg -T experiments/data/iwslt-envi/tst2012.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_ensemble3runs
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2012.vi < experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_ensemble3runs &>experiments/models/iwslt-envi/translation-beam5.tst2012.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_ensemble3runs.score-BLEU
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:6 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-sinusoid-ensemble3runs.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_ensemble3runs
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_ensemble3runs &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_ensemble3runs.score-BLEU

# w/ dropout + w/ label smoothing (w/ adam trainer + sinusoid encoding)
nice ./build_gpu/transformer-train --dynet-devices GPU:7 --max-seq-len 150 --minibatch-size 1024  --treport 1000 --dreport 20000  --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped -p experiments/models/iwslt-envi/params.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam -e 100 --lr-eta 0.001 --sgd-trainer 4 --lr-patience 10 --patience 20 --lr-eta-decay 1.5 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/iwslt-envi/log.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam &
# tst2013
# beam5
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:4 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi --beam 5 --model-cfg experiments/models/iwslt-envi/model-large-dropout-labelsm-adam-sinusoid.cfg -T experiments/data/iwslt-envi/tst2013.en.vcb.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl ~/tools/nmt/nmt/scripts/iwslt15/tst2013.vi < experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam &>experiments/models/iwslt-envi/translation-beam5.test2013.en-vi.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml150_ffrelu_adam.score-BLEU

# very large network
# w/o dropout
nice ./build_gpu/transformer-train --dynet-devices GPU:4 --max-seq-len 150 --max-pos-seq-len 150 --minibatch-size 1024 --treport 100 --dreport 10000 --src-vocab experiments/data/iwslt-envi/vocab.en --tgt-vocab experiments/data/iwslt-envi/vocab.vi -t experiments/data/iwslt-envi/train.en-vi.vcb.capped -d experiments/data/iwslt-envi/tst2012.en-vi.vcb.capped u -p experiments/models/iwslt-envi/params.en-vi.transformer.h16_l6_u1024_do000000000000_att1_ls00_pe1_ml150_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.0 --encoder-sublayer-dropout-p 0.0 --decoder-emb-dropout-p 0.0 --decoder-sublayer-dropout-p 0.0 --attention-dropout-p 0.0 --ff-dropout-p 0.0 --ff-activation-type 1 --nlayers 6 --num-units 1024 --num-heads 16 &>experiments/models/iwslt-envi/log.en-vi.transformer.h16_l6_u1024_do000000000000_att1_ls00_pe1_ml150_ffrelu &



