# KFTT (English-Japanese)
mkdir experiments/models/kftt/

# preprocessing (lowercasing)
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/tokenizer/lowercase.perl < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en 
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/tokenizer/lowercase.perl < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja 

/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/tokenizer/lowercase.perl < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en 
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/tokenizer/lowercase.perl < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.ja 

/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/tokenizer/lowercase.perl < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en 
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/tokenizer/lowercase.perl < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja 

python ~/works/transformer-dynet/scripts/wrap-data.py ja en kyoto-train.cln.lo kyoto-dev-tune.lo kyoto-test.lo 3 3
python ~/works/transformer-dynet/scripts/wrap-data.py en ja kyoto-train.cln.lo kyoto-dev-tune.lo kyoto-test.lo 3 3

# BPE-ing
# 25K operations
cat /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja | /home/vhoang2/tools/subword-nmt/learn_bpe.py -s 25000 > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned #joint subword splitting
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K.en #train
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K.ja #train
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe25K.en #dev
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe25K.ja #dev
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe25K.en #test
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe25K.ja #test

python ~/works/transformer-dynet/scripts/wrap-data.py ja en kyoto-train.cln.lo.jbpe25K kyoto-dev-tune.lo.jbpe25K kyoto-test.lo.jbpe25K 1 1
python ~/works/transformer-dynet/scripts/wrap-data.py en ja kyoto-train.cln.lo.jbpe25K kyoto-dev-tune.lo.jbpe25K kyoto-test.lo.jbpe25K 1 1

# 32K
cat /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja | /home/vhoang2/tools/subword-nmt/learn_bpe.py -s 32000 > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned #joint subword splitting
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.en #train
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.ja #train
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe32K.en #dev
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe32K.ja #dev
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe32K.en #test
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe32K.ja #test

python ~/works/transformer-dynet/scripts/wrap-data.py ja en kyoto-train.cln.lo.jbpe32K kyoto-dev-tune.lo.jbpe32K kyoto-test.lo.jbpe32K 1 1
python ~/works/transformer-dynet/scripts/wrap-data.py en ja kyoto-train.cln.lo.jbpe32K kyoto-dev-tune.lo.jbpe32K kyoto-test.lo.jbpe32K 1 1

# 64K
cat /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja | /home/vhoang2/tools/subword-nmt/learn_bpe.py -s 64000 > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned #joint subword splitting
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K.en #train
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K.ja #train
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe64K.en #dev
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe64K.ja #dev
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe64K.en #test
/home/vhoang2/tools/subword-nmt/apply_bpe.py -c /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K_learned < /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja > /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe64K.ja #test

python ~/works/transformer-dynet/scripts/wrap-data.py ja en kyoto-train.cln.lo.jbpe64K kyoto-dev-tune.lo.jbpe64K kyoto-test.lo.jbpe64K 1 1
python ~/works/transformer-dynet/scripts/wrap-data.py en ja kyoto-train.cln.lo.jbpe64K kyoto-dev-tune.lo.jbpe64K kyoto-test.lo.jbpe64K 1 1

# *** small networks
# train
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 50 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml50_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 2 --num-units 128 --num-heads 2 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml50_ffrelu &
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:0 --max-seq-len 50  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-small-dropout-labelsm-sinusoid.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en.capped | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml50_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml50_ffrelu &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h2_l2_u128_do010101010001_att1_ls01_pe2_ml50_ffrelu.score-BLEU

# *** medium networks
# train
nice ./build_gpu/transformer-train --dynet-devices GPU:2 --max-seq-len 50 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu &
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:1 --max-seq-len 50  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-medium-dropout-labelsm-sinusoid.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en.capped | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu.score-BLEU

# *** medium networks (with byte-pair encoding, 25K operations)
# train
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 80 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe25K.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe25K -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe25K &
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:2 --max-seq-len 80  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe25K.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-medium-dropout-labelsm-sinusoid-jbpe25K.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe25K.en.capped | sed 's/@@ //g' | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe25K
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe25K &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe25K.score-BLEU

# *** medium networks (with byte-pair encoding, 32K operations)
# train
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 80 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe32K.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K &
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:0 --max-seq-len 80  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-medium-dropout-labelsm-sinusoid-jbpe32K.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe32K.en.capped | sed 's/@@ //g' | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K.score-BLEU

# *** medium networks (with byte-pair encoding, 32K operations) (run2)
# train
nice ./build_gpu/transformer-train --dynet-devices GPU:0 --max-seq-len 80 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe32K.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_run2 -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_run2 &
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:0 --max-seq-len 80  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-medium-dropout-labelsm-sinusoid-jbpe32K-run2.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe32K.en.capped | sed 's/@@ //g' | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_run2
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_run2 &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_run2.score-BLEU

# ensemble decode
# test
./build_gpu/transformer-decode --dynet-mem 12000 --dynet-devices GPU:0 --max-seq-len 80  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe32K.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-medium-dropout-labelsm-sinusoid-jbpe32K-ensemble2runs.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe32K.en.capped | sed 's/@@ //g' | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_ensemble2runs
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_ensemble2runs &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe32K_ensemble2runs.score-BLEU

# *** medium networks (with byte-pair encoding, 64K operations)
# train
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 80 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.jbpe64K.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe64K -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 4 --num-units 512 --num-heads 4 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe64K &
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:2 --max-seq-len 80  -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.jbpe64K.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-medium-dropout-labelsm-sinusoid-jbpe64K.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.jbpe64K.en.capped | sed 's/@@ //g' | sed 's/ <\/s>//g' | sed 's/<s> //g' > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe64K
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe64K &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h4_l4_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu_jbpe64K.score-BLEU

# *** large networks
# train
# w/ dropout + w/ label smoothing + w/ sinusoid positional encoding
nice ./build_gpu/transformer-train --dynet-devices GPU:1 --max-seq-len 50 --minibatch-size 1024 --treport 1000 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en-ja.capped -p experiments/models/kftt/params.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu &
nice ./build_gpu/transformer-train --dynet-devices GPU:5 --max-seq-len 50 --minibatch-size 1024 --treport 512 --dreport 50000 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped -d /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-dev-tune.lo.en-ja.capped -i experiments/models/kftt/params.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu -p experiments/models/kftt/params.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu -e 100 --lr-eta 0.1 --lr-patience 10 --patience 20 --lr-eta-decay 2 --encoder-emb-dropout-p 0.1 --encoder-sublayer-dropout-p 0.1 --decoder-emb-dropout-p 0.1 --decoder-sublayer-dropout-p 0.1 --attention-dropout-p 0.0 --ff-dropout-p 0.1 --ff-activation-type 1 --nlayers 6 --num-units 512 --num-heads 8 --use-label-smoothing --label-smoothing-weight 0.1 --position-encoding 2 &>experiments/models/kftt/log1.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu & #continued
# decode
# test
./build_gpu/transformer-decode --dynet-mem 5000 --dynet-devices GPU:3 --max-seq-len 50 -t /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-train.cln.lo.en-ja.capped --beam 5 --model-cfg experiments/models/kftt/model-baseline-large-dropout-labelsm-sinusoid.cfg -T /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.en.capped | sed 's/ <\/s>//g' | sed "s/<s> //g" > experiments/models/kftt/translation-beam5.test.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu
/home/vhoang2/tools/mosesdecoder-RELEASE-3.0/scripts/generic/multi-bleu.perl /home/vhoang2/works/transformer-dynet/experiments/data/kftt/kftt-data-1.0/data/tok/kyoto-test.lo.ja.capped < experiments/models/kftt/translation-beam5.test.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu &>experiments/models/kftt/translation-beam5.test.en-ja.transformer.h8_l6_u512_do010101010001_att1_ls01_pe2_ml50_ffrelu.score-BLEU


